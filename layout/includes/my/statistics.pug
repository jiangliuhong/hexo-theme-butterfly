//- echarts
//- link(rel='stylesheet', href=url_for(theme.CDN.main_css))
div(id="postCharts" class="post-charts")
  div(class="row")
    div(id="posts-chart")
  div(class="row")
    div(id="categories-chart")
  div(class="row")
    div(id="tags-chart")


//- 引入echarts组件
script(src=url_for(site.data.my.libs.js.echarts))
//- 统计文章
- let monthMap= new Map()
- let startDate= moment().subtract(1, 'years').startOf('month')
- let endDate= moment().endOf('month')
- let dayTime= 3600 * 24 * 1000
- let time= startDate
while time <= endDate
    -let month= moment(time).format('YYYY-MM')
    if monthMap.has(month) === false
        - monthMap.set(month, 0)
    - time= time + dayTime

each post in site.posts.data
  - let m = post.date.format('YYYY-MM')
  if monthMap.has(m) === true
    - monthMap.set(m, monthMap.get(m) + 1)

- let monthArr= JSON.stringify([...monthMap.keys()])
- let monthValueArr= JSON.stringify([...monthMap.values()])

script(type='text/javascript').
    let postsChart = echarts.init(document.getElementById('posts-chart'));
    
    
    var monthArr = !{monthArr}
    var monthValueArr =  !{monthValueArr}

    var postsOption = {
        title: {
            text: '文章发布统计图',
            top: -5,
            x: 'center'
        },
        tooltip: {
            trigger: 'axis'
        },
        xAxis: {
            type: 'category',
            data: !{monthArr}
        },
        yAxis: {
            type: 'value',
        },
        series: [
            {
                name: '文章篇数',
                type: 'line',
                color: ['#6772e5'],
                data:  !{monthValueArr},
                markPoint: {
                    symbolSize: 45,
                    color: ['#fa755a','#3ecf8e','#82d3f4'],
                    data: [{
                        type: 'max',
                        itemStyle: {color: ['#3ecf8e']},
                        name: '最大值'
                    }, {
                        type: 'min',
                        itemStyle: {color: ['#fa755a']},
                        name: '最小值'
                    }]
                },
                markLine: {
                    itemStyle: {color: ['#ab47bc']},
                    data: [
                        {type: 'average', name: '平均值'}
                    ]
                }
            }
        ]
    };
    postsChart.setOption(postsOption);

//- 统计分类
- let categoryArr = []
each category in site.categories.data
  - categoryArr.push({'name': category.name, 'value': category.length})
- let categoryArrJson = JSON.stringify(categoryArr);
script(type='text/javascript').
  let categoriesChart = echarts.init(document.getElementById('categories-chart'));
  let categoriesOption = {
        title: {
            text: '文章分类统计图',
            top: -4,
            x: 'center'
        },
        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },
        series: [
            {
                name: '分类',
                type: 'pie',
                radius: '50%',
                color: ['#6772e5', '#ff9e0f', '#fa755a', '#3ecf8e', '#82d3f4', '#ab47bc', '#525f7f', '#f51c47', '#26A69A'],
                data: !{categoryArrJson},
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }
        ]
    };
    categoriesChart.setOption(categoriesOption);

//- 统计标签
- let tagArr = []
each tag in site.tags.data
  - tagArr.push({'name': tag.name, 'value': tag.length})
- tagArr.sort((a, b) => {return b.value - a.value})
- let tagNameArr = []
- let tagCountArr = []
- for (var i = 0, len = Math.min(tagArr.length, 10); i < len; i++) {
  - tagNameArr.push(tagArr[i].name);
  - tagCountArr.push(tagArr[i].value);
- }
- let tagNameArrJson = JSON.stringify(tagNameArr);
- let tagCountArrJson = JSON.stringify(tagCountArr);
script(type='text/javascript').
  let tagsChart = echarts.init(document.getElementById('tags-chart'));
  let tagsOption = {
        title: {
            text: 'TOP10 标签统计图',
            top: -5,
            x: 'center'
        },
        tooltip: {},
        xAxis: [
            {
                type: 'category',
                axisLabel:{
                    interval:0,
                    rotate:40
                },
                data: !{tagNameArrJson}
            }
        ],
        yAxis: [
            {
                type: 'value'
            }
        ],
        series: [
            {
                name: 'TOP10标签统计',
                type: 'bar',
                color: ['#82d3f4'],
                barWidth : 18,
                data: !{tagCountArrJson},
                markPoint: {
                    symbolSize: 45,
                    data: [{
                        type: 'max',
                        itemStyle: {color: ['#3ecf8e']},
                        name: '最大值'
                    }, {
                        type: 'min',
                        itemStyle: {color: ['#fa755a']},
                        name: '最小值'
                    }],
                },
                markLine: {
                    itemStyle: {color: ['#ab47bc']},
                    data: [
                        {type: 'average', name: '平均值'}
                    ]
                }
            }
        ]
    };
    tagsChart.setOption(tagsOption);